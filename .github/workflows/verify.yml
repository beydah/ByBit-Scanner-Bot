name: Enterprise Governance Check

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  governance:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install ruff
        
    - name: Use Ruff to check complexity and standards
      run: |
        # RUFF_FORMAT: snake_case enforcement and complexity check
        ruff check . --select E,F,W,C90 --ignore E501
        
    - name: Structural Governance Check
      run: |
        # Verify root directory limits (Max 5 folders, 10 files)
        DIR_COUNT=$(find . -maxdepth 1 -type d -not -path '*/.*' -not -path '.' | wc -l)
        FILE_COUNT=$(find . -maxdepth 1 -type f -not -path '*/.*' | wc -l)
        
        echo "Folders: $DIR_COUNT, Files: $FILE_COUNT"
        
        if [ $DIR_COUNT -gt 5 ]; then
          echo "ERROR: Too many root folders ($DIR_COUNT > 5)"
          exit 1
        fi
        
        if [ $FILE_COUNT -gt 10 ]; then
          echo "ERROR: Too many root files ($FILE_COUNT > 10)"
          exit 1
        fi
